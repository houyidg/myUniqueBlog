# 分析网络流量数据

在先前的章节中，在代码里写入流量标识，运行了测试并且收集了流量数据。本节课教你如何查看已经收集的网络流量数据，并且指导你提升程序网络性能以及减少电量消耗

## 分析程序网络流量

在app里高效使用的网络资源的特点是在不使用网络硬件的时期。在使用移动设备的时候，开启网络发送或者接受数据，保持移动无线通很长一段时间处理激活状态操作会十分消耗性能。如果你的app正在高效的访问网络，你应该可以看到app在网络上的通信在紧紧的被组合在一起，并且app没有网络连接请求的地方会被很好的间隔起来。

图1显示来自程序的次优化网络流量，这是由网络流量工具测量的。这款应用正在频繁的请求网络。这个通信路有很少的休息时间让无线通信设备切换到待机，低电量模式。这款应用网络访问行文很可能会让无线通信设备持续很长一段时间，这是电池低效的。
如图：
![avatar](/photo/suboptimal_network_traffic_pattern.png)
图1：低效率电池网络活动

图2展示一个优化网络流量的图案。这个应用以爆发式的发送了很多网络请求，且这个过程有很长一段时间没有流量无线通信设备可以转换到待机状态。这个图表和图1展示了相同请求量的工作，而且这些请求被转换且分组去允许无线通信设备在大部分时间待机。
![avatar](/photo/optimal_network_traffic_pattern.png)
图2：高效率电池网络活动

如果你的应用程序的网络流量看起来和图2差不多，那么恭喜你已经做的很好了！在未来，也许你想去追求网络更有效率通过学习优化一般的网络使用技术

如果你的应用程序的网络流量看起来和图1差不多，那么是时候花时间去查看你程序如何去访问网络的。你应该从按类型分析你的程序生成的网络流量开始。


## 分析网络流量类型
在你观察你的应用程序生成的网络流量的时候，你需要去理解流量的来源，以至于你能够正确的优化他。你的程序对用户的操作做出频繁的网络活动也许是王权合适的，但是如果你的程序不在前台或者手机设备在口袋或者手提袋，这样的操作是完全不合适的。这章节讨论的是怎么样分析程序生成的网络流量以及针对你的代码如何改善性能。

## 分析用发起的网络流量
用户发起的网络活动可以有效地组合在一起，而用户则通过应用程序执行特定的活动，或者在用户请求应用程序需要获得的额外信息时不均衡地展开。在分析用户发起的网络流量时，您的目标是寻找频繁使用网络的模式，并尝试创建或增加不访问网络的时间段的大小。

用户请求的不可预测性使得在你的应用中优化这种类型的网络使用变得很困难。此外，用户在积极使用应用程序时，期望得到快速响应，因此延迟对效率的要求会导致用户体验不佳。一般来说，当用户与应用程序直接交互时，您应该优先对用户进行快速响应，而不是有效地使用网络。

下面是一些优化用户发起的网络流量的方法：
1. 预取网络数据——当用户在你的应用中执行一个动作时，应用程序会预测下一个用户动作可能需要哪 数据，在一个连接中批量获取它，并将其保存到用户请求它为止。
2. 检查连接或监听更改——检查网络连接，或者在执行更新之前监听连接更改。
3. 减少连接的数量——使用服务器api，允许在集合中下载数据。

## 分析应用自己发起的网络流量
由您的应用程序代码发起的网络活动通常是一个您可以对网络带宽的有效使用产生重大影响的领域。在分析应用程序的网络活动时，寻找不活动的时间段，并确定它们是否可以增加。如果你从你的应用中看到了一致的网络访问模式，那就寻找一些方法来留出这些访问空间，让无线通信设备能够切换到低功耗模式。

下面是一些优化应用程序发起的网络流量的方法：
1. 批处理和调度网络请求——推迟应用程序的网络请求，这样它们就可以一起处理，并且在一个对电池寿命有利的时候。
2. 允许系统检查连接——避免运行应用程序的电池成本，只是为了检查网络连接，当你可以让系统在你的应用程序休眠时运行检查。

## 分析由服务端发起的网络流浪
与应用程序通信的服务器发起的网络活动通常也是一个可以对有效使用网络带宽产生重大影响的领域。在分析来自服务器连接的网络活动时，寻找不活动的时间段，并确定它们是否可以增加。如果您看到来自服务器的一致网络活动的模式，那么就寻找方法来将这个活动空间排除在外，以允许设备无线电切换到低功率模式。

下面是一种优化应用程序发起的网络流量的方法：
1. 使用GCM进行服务器更新——考虑使用Google云消息服务进行服务器端更新，而不是轮询。